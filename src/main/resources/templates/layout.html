<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:replace="~{::title}">Store</title>
    <link rel="stylesheet" href="/css/styles.css"/>
</head>


<body>
<nav th:fragment="nav">
    <a href="/">Home</a> |
    <a href="/products">Products</a> |
    <a href="/cart">Cart</a> |
    <a href="/orders">Orders</a> |
    <a href="/admin">Admin</a> |
    <a href="/register">Register</a> |
    <a href="/login" id="loginL">Login</a>
    <a href="#" id="logout">Logout</a>
</nav>

<script>
    // Parse roles from JWT (payload is the middle '.' part, base64url)
    function getRoles(){
        try{
            const t = localStorage.getItem('token');
            if(!t) return [];
            const payload = JSON.parse(atob(t.split('.')[1]));
            return payload.roles || [];
        }catch{ return []; }
    }

    function updateNav(){
        const nav = document.querySelector('nav');
        if(!nav) return;

        // Login / Logout toggle
        const t = localStorage.getItem('token');
        const login = document.getElementById('loginL');
        let logout = document.getElementById('logout');

        if(t){
            if(!logout){
                logout = document.createElement('a');
                logout.id = 'logout';
                logout.href = '#';
                logout.innerText = 'Logout';
                logout.onclick = () => { localStorage.removeItem('token'); location.href='/login'; };
                nav.append(' | ', logout);
            }
            if(login) login.style.display = 'none';
        }else{
            if(login) login.style.display = '';
            if(logout) logout.remove();
        }

        // Role label (for clarity)
        const roles = getRoles();
        let tag = document.getElementById('roleTag');
        if(!tag){
            tag = document.createElement('span');
            tag.id = 'roleTag';
            tag.style.marginLeft = '8px';
            tag.style.opacity = '0.7';
            nav.append(' ', tag);
        }
        tag.textContent = roles.length ? `(${roles.join(',')})` : '(guest)';
    }

    updateNav();
</script>


<main>
    <section th:replace="~{::section}"></section>
</main>
<footer><p>Â© 2025 Store</p></footer>
</body>
</html>
